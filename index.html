<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WILL.TOLEARN - Profile</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tilt+Prism&family=Space+Grotesk:wght@400;700&family=Snippet&family=Sofia&display=swap" rel="stylesheet">
    
    <style>
        :root { --text-color: #ffffff; --bg-color: #000000; --border-color: #ffffff; }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Space Grotesk', sans-serif; margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 40px; box-sizing: border-box; }
        .top-welcome-header { width: 100%; max-width: 1200px; padding-bottom: 1.5rem; border-bottom: 2px solid var(--border-color); margin-bottom: 2rem; }
        .welcome-title { font-size: 2.5rem; font-weight: 700; }
        .logo-i { font-family: 'Tilt Prism', cursive; }
        .to-learn { font-family: 'Snippet', sans-serif; font-size: 3rem; }
        .main-wrapper { position: relative; width: 100%; max-width: 1100px; display: flex; flex-direction: column; gap: 10px; }
        .mode-switcher { display: flex; gap: 20px; margin-bottom: 20px; }
        .mode-btn { background: transparent; border: 2px solid var(--border-color); color: #fff; padding: 10px 30px; border-radius: 50px; cursor: pointer; font-weight: 700; transition: 0.3s; }
        .mode-btn.active { background: #fff; color: #000; }
        .main-title { font-size: clamp(60px, 10vw, 120px); font-family: 'Sofia', cursive; line-height: 1; margin: 0; }
        .content-row { display: flex; align-items: center; justify-content: space-between; margin-top: 30px; gap: 40px; width: 100%; }
        .input-group { display: flex; flex-direction: column; gap: 30px; flex: 1; }
        .field { display: flex; align-items: center; gap: 20px; }
        .field label { font-size: 28px; min-width: 180px; font-family: 'Sofia', cursive; }
        .field input { background: #fff; border: none; border-radius: 50px; height: 55px; width: 100%; padding: 0 25px; font-size: 22px; color: #000; outline: none; }
        .profile-ring { width: 200px; height: 200px; border: 8px solid #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 100px; background: rgba(255,255,255,0.05); }
        .continue-btn { font-family: 'Tilt Prism', cursive; font-size: 1.75rem; background: #fff; color: #000; padding: 0.75rem 2.5rem; border-radius: 0.75rem; cursor: pointer; margin-top: 50px; align-self: flex-end; }
        .continue-btn:disabled { opacity: 0.5; }
        @media (max-width: 900px) { .content-row { flex-direction: column; } .continue-btn { align-self: center; } }
    </style>
</head>
<body>

    <header class="top-welcome-header">
        <h1 class="welcome-title">WELCOME TO W<span class="logo-i">I</span>LL.<span class="to-learn">TOLEARN</span></h1>
    </header>

    <div class="main-wrapper">
        <div class="mode-switcher">
            <button class="mode-btn active" id="signupMode">SIGN UP</button>
            <button class="mode-btn" id="loginMode">LOG IN</button>
        </div>

        <h1 class="main-title" id="headerAction">"PROFILE"</h1>

        <div class="content-row">
            <div class="input-group">
                <div class="field">
                    <label>USER</label>
                    <input type="text" id="usernameInput" placeholder="Username">
                </div>
                <div class="field">
                    <label>PASS</label>
                    <input type="password" id="passwordInput" placeholder="Min 8 chars">
                </div>
            </div>
            <div class="profile-ring" id="profileDisplay">@</div>
        </div>

        <button class="continue-btn" id="continueButton">CONTINUE</button>
    </div>

    <script>
        const { Client, Account, Functions } = Appwrite;
        const client = new Client()
            .setEndpoint('https://cloud.appwrite.io/v1')
            .setProject('696750780007c6fc4cba'); 

        const functions = new Functions(client);
        
        const usernameInput = document.getElementById('usernameInput');
        const passwordInput = document.getElementById('passwordInput');
        const profileDisplay = document.getElementById('profileDisplay');
        const continueBtn = document.getElementById('continueButton');
        const signupModeBtn = document.getElementById('signupMode');
        const loginModeBtn = document.getElementById('loginMode');

        let currentMode = 'signup';

        signupModeBtn.onclick = () => { currentMode = 'signup'; signupModeBtn.classList.add('active'); loginModeBtn.classList.remove('active'); continueBtn.innerText = "CONTINUE"; };
        loginModeBtn.onclick = () => { currentMode = 'login'; loginModeBtn.classList.add('active'); signupModeBtn.classList.remove('active'); continueBtn.innerText = "LOG IN"; };

        usernameInput.oninput = (e) => { profileDisplay.innerText = e.target.value ? e.target.value.charAt(0).toUpperCase() : '@'; };

        continueBtn.onclick = async () => {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            if (!username || password.length < 8) return alert("Invalid inputs!");

            continueBtn.disabled = true;
            continueBtn.innerText = "BRIDGE CONNECTING...";

            try {
                // Call the bridge function
                const execution = await functions.createExecution(
                    'mongoBridge', // MUST MATCH YOUR FUNCTION ID
                    JSON.stringify({ username, password, mode: currentMode })
                );

                const result = JSON.parse(execution.responseBody);

                if (result.success) {
                    localStorage.setItem('username', username);
                    window.location.href = 'https://willtolearnofficial.github.io/WILL.TOLEARN/home.html';
                } else {
                    alert(result.message);
                    continueBtn.disabled = false;
                    continueBtn.innerText = "TRY AGAIN";
                }
            } catch (err) {
                alert("Check Appwrite Function Deployment");
                continueBtn.disabled = false;
            }
        };
    </script>
</body>
</html>
