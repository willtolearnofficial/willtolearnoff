<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WILL.TOLEARN - Profile</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tilt+Prism&family=Space+Grotesk:wght@400;700&family=Snippet&family=Sofia&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>

    <style>
        :root {
            --text-color: #ffffff;
            --bg-color: #000000;
            --border-color: #ffffff;
            --accent-blue: #2b57ff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Space Grotesk', sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            padding: 20px;
            box-sizing: border-box;
        }

        .top-welcome-header {
            width: 100%;
            max-width: 1200px;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 2rem;
            text-align: left;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            letter-spacing: 1px;
        }

        .logo-i { font-family: 'Tilt Prism', cursive; margin: 0 2px; }
        .to-learn { font-family: 'Snippet', sans-serif; font-size: 3rem; vertical-align: middle; }

        .main-wrapper {
            position: relative;
            width: 100%;
            max-width: 1100px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mode-switcher { display: flex; gap: 20px; margin-bottom: 20px; }

        .mode-btn {
            background: transparent;
            border: 2px solid var(--border-color);
            color: #fff;
            padding: 10px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            transition: 0.3s;
        }

        .mode-btn.active { background: #fff; color: #000; }

        .header-text { font-size: 28px; font-family: 'Sofia', cursive; margin-bottom: -15px; }
        .main-title { font-size: clamp(50px, 8vw, 100px); margin: 0; letter-spacing: 5px; line-height: 1; font-family: 'Sofia', cursive; }

        .content-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 30px;
            gap: 40px;
            width: 100%;
        }

        .input-group { display: flex; flex-direction: column; gap: 20px; flex: 1; }

        .field { display: flex; align-items: center; gap: 20px; }
        .field label { font-size: 22px; min-width: 160px; text-transform: uppercase; font-family: 'Sofia', cursive; }
        .field input {
            background: #fff;
            border: none;
            border-radius: 50px;
            height: 50px;
            width: 100%;
            padding: 0 25px;
            font-family: 'Sofia', sans-serif;
            font-size: 18px;
            outline: none;
            color: #000;
        }

        .profile-container { position: relative; flex-shrink: 0; }
        .profile-ring {
            width: 180px; height: 180px;
            border: 8px solid #fff;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 90px; font-family: 'Sofia', sans-serif;
            background: rgba(255,255,255,0.05);
        }

        .footer-wrapper { margin-top: 40px; display: flex; justify-content: flex-end; width: 100%; }
        .continue-btn {
            font-family: 'Tilt Prism', cursive; font-size: 1.5rem;
            background-color: var(--text-color); color: var(--bg-color);
            border: 2px solid var(--text-color); padding: 0.75rem 2.5rem;
            border-radius: 0.75rem; cursor: pointer; transition: all 0.3s ease;
        }

        .continue-btn:hover { background-color: var(--bg-color); color: var(--text-color); box-shadow: 0 0 15px var(--text-color); }
        .continue-btn:disabled { opacity: 0.6; cursor: wait; }

        .hidden { display: none !important; }

        @media (max-width: 900px) {
            .content-row { flex-direction: column; }
            .field { flex-direction: column; align-items: flex-start; }
            .field label { min-width: unset; }
        }
    </style>
</head>
<body>

    <header class="top-welcome-header">
        <h1 class="welcome-title">WELCOME TO W<span class="logo-i">I</span>LL.<span class="to-learn">TOLEARN</span></h1>
    </header>

    <div class="main-wrapper">
        <div class="mode-switcher">
            <button class="mode-btn active" id="signupMode">SIGN UP</button>
            <button class="mode-btn" id="loginMode">LOG IN</button>
        </div>

        <div class="header-text" id="headerAction">COMPLETE YOUR</div>
        <h1 class="main-title">"PROFILE"</h1>

        <div class="content-row">
            <div class="input-group">
                <div class="field">
                    <label id="userLabel">USERNAME</label>
                    <input type="text" id="usernameInput" spellcheck="false" placeholder="Your Name">
                </div>
                <div class="field" id="emailField">
                    <label>EMAIL</label>
                    <input type="email" id="emailInput" placeholder="email@example.com">
                </div>
                <div class="field">
                    <label>PASSWORD</label>
                    <input type="password" id="passwordInput" placeholder="••••••••">
                </div>
            </div>

            <div class="profile-container">
                <div class="profile-ring" id="profileDisplay">@</div>
            </div>
        </div>

        <div class="footer-wrapper">
            <button class="continue-btn" id="continueButton">CONTINUE</button>
        </div>
    </div>

    <script>
        const { Client, Account, ID } = Appwrite;
        const client = new Client()
            .setEndpoint('https://fra.cloud.appwrite.io/v1') 
            .setProject('69679293001b8cd4ab6e');

        const account = new Account(client);

        const usernameInput = document.getElementById('usernameInput');
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const emailField = document.getElementById('emailField');
        const userLabel = document.getElementById('userLabel');
        const profileDisplay = document.getElementById('profileDisplay');
        const continueBtn = document.getElementById('continueButton');
        const signupModeBtn = document.getElementById('signupMode');
        const loginModeBtn = document.getElementById('loginMode');
        const headerAction = document.getElementById('headerAction');

        let currentMode = 'signup';

        // 1. AUTO-REDIRECT IF ALREADY LOGGED IN
        window.addEventListener('load', async () => {
            try {
                const user = await account.get();
                if (user) {
                    console.log("Active session found for:", user.name);
                    window.location.href = 'https://willtolearnofficial.github.io/WILL.TOLEARN/home.html';
                }
            } catch (error) {
                console.log("No active session. Ready for login/signup.");
            }
        });

        // --- TOGGLE LOGIC ---
        signupModeBtn.addEventListener('click', () => {
            currentMode = 'signup';
            signupModeBtn.classList.add('active');
            loginModeBtn.classList.remove('active');
            emailField.classList.remove('hidden');
            userLabel.innerText = "USERNAME";
            headerAction.innerText = "COMPLETE YOUR";
            continueBtn.innerText = "CONTINUE";
        });

        loginModeBtn.addEventListener('click', () => {
            currentMode = 'login';
            loginModeBtn.classList.add('active');
            signupModeBtn.classList.remove('active');
            emailField.classList.add('hidden'); 
            userLabel.innerText = "EMAIL";
            headerAction.innerText = "ACCESS YOUR";
            continueBtn.innerText = "LOG IN";
        });

        usernameInput.addEventListener('input', (e) => {
            const value = e.target.value;
            profileDisplay.innerText = value.length > 0 ? value.charAt(0).toUpperCase() : '@';
        });

        // --- AUTH LOGIC ---
        continueBtn.addEventListener('click', async () => {
            const userVal = usernameInput.value.trim();
            const emailVal = emailInput.value.trim();
            const passwordVal = passwordInput.value.trim();

            if (!passwordVal || (currentMode === 'signup' && (!userVal || !emailVal)) || (currentMode === 'login' && !userVal)) {
                alert("Please fill in all fields.");
                return;
            }

            continueBtn.disabled = true;
            continueBtn.innerText = "PROCESSING...";

            try {
                if (currentMode === 'signup') {
                    await account.create(ID.unique(), emailVal, passwordVal, userVal);
                    await account.createEmailSession(emailVal, passwordVal);
                    localStorage.setItem('username', userVal);
                } else {
                    await account.createEmailSession(userVal, passwordVal);
                    const user = await account.get();
                    localStorage.setItem('username', user.name);
                }

                window.location.href = 'https://willtolearnofficial.github.io/WILL.TOLEARN/home.html';

            } catch (error) {
                // 2. HANDLE "SESSION ALREADY ACTIVE" ERROR
                if (error.message.includes("active")) {
                    console.log("Session already active. Redirecting...");
                    window.location.href = 'https://willtolearnofficial.github.io/WILL.TOLEARN/home.html';
                    return;
                }

                console.error(error);
                alert("Error: " + error.message);
                continueBtn.disabled = false;
                continueBtn.innerText = currentMode === 'signup' ? "CONTINUE" : "LOG IN";
            }
        });
    </script>
</body>
</html>
